# GenerativeModel-HMM implementation
#
#
SHELL=/bin/bash
PYTHON=python

SRC=src
BIN=bin
DATA=data
MODELS=models
nepochs=
nclasses=
MODELS_INTERM=$(shell echo $(MODELS)/epoch{1..$(nepochs)}.mdl)
training_data=$(DATA)/train13.pkl
testing_data=$(DATA)/test13.pkl

all: train

init:
	mkdir -p $(MODELS) 


prepare_data: $(training_data) $(testing_data)
	$(PYTHON) $(BIN)/prepare_data.py $(nclasses) $^

train: 
	for i in $(MODELS_INTERM); do \
		$(MAKE) -f Makefile_run -j $(nclasses) -s $$i; \
		sleep 1;\
	done
#	echo "Done" > $^


$(MODELS)/%.mdl: 
	$(PYTHON) $(BIN)/aggregate_models.py $@
	$(PYTHON) $(BIN)/compute_accuracy.py $@ $(training_data) $(testing_data)


$(MODELS)/%.mdlc:
	$(PYTHON) $(BIN)/train_class.py $(training_data) $@

clean:
	rm -f $(DATA)/train*_*.pkl
	rm -f $(DATA)/test*_*.pkl 
	rm -f $(MODELS)/epoch*.mdl 
	rm -f $(MODELS)/epoch*_class*.mdlc 
	rm -f Makefile_run


.SECONDARY: 

.PRECIOUS:
